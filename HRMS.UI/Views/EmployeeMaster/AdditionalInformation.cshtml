@{
	ViewData["Title"] = "Additional Information";
	Layout = "~/Views/Shared/_mainLayout.cshtml";
	string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
	var uri = new Uri(baseUrl);
	string baseDomainUrl = $"{uri.Scheme}://{uri.Host}:{uri.Port}";
}
<style>
	#profileImage {
		width: 150px;
		height: 150px;
		border-radius: 50%;
		object-fit: cover;
		cursor: pointer;
	}

	#fileInfo {
		margin-top: 5px;
		display: flex;
		align-items: center;
		gap: 8px;
	}

		#fileInfo small {
			color: green;
		}

		#fileInfo i {
			cursor: pointer;
			color: red;
		}



	#cropModal .modal-dialog {
		max-width: 600px; /* Optional: limit modal width */
	}

	#cropModal .modal-body {
		max-height: 70vh;
		overflow: auto;
	}

	#cropImagePreview {
		max-width: 100%;
		max-height: 60vh;
		display: block;
		margin: 0 auto;
	}

	.nav-link {
		text-align: center;
		font-size: 14px;
		color: #333 !important;
		transition: color 0.3s;
	}

		.nav-link i {
			font-size: 20px;
			display: block;
			margin-bottom: 4px;
			color: #666;
			transition: color 0.3s;
		}

		/* Hover and Active (Text + Icon) */
		.nav-link:hover,
		.nav-link:hover i,
		.nav-link.active,
		.nav-link.active i {
			color: #007bff !important;
		}

	.navbar-nav {
		justify-content: space-around;
		width: 100%;
	}

</style>

<div class="card" id="employeeDetailsCard">
	<div class="card-header bg-primary text-white">
		<h5 class="mb-0 d-flex justify-content-between align-items-center">
			Employee Details
			<i class="fas fa-arrow-circle-left cursor-pointer" id="backArrow"></i>
		</h5>

	</div>

	<div class="card-body">
		<div class="row">
			<!-- Left Side: Form Data -->
			<div class="col-md-8">
				
				<div class="card-body" id="displaySectionEmoplyee" >

						<div class="row">
							<div class="col-md-6 mb-2"><strong>Initial:</strong> Mr.</div>
							<div class="col-md-6 mb-2"><strong>First Name:</strong> Ramesh</div>
							<div class="col-md-6 mb-2"><strong>Middle Name:</strong> Kumar</div>
							<div class="col-md-6 mb-2"><strong>Last Name:</strong> Chauhan</div>
							<div class="col-md-6 mb-2"><strong>Employee Code:</strong> 0004</div>
							<div class="col-md-6 mb-2"><strong>Date of Joining:</strong> 2023-07-15</div>
							<div class="col-md-6 mb-2"><strong>Branch:</strong> Mumbai</div>
							<div class="col-md-6 mb-2"><strong>Grade:</strong> MANAGEMENT</div>
							<div class="col-md-6 mb-2"><strong>Shift:</strong> Day Shift</div>
							<div class="col-md-6 mb-2"><strong>CTC:</strong> ₹8,50,000</div>
							<div class="col-md-6 mb-2"><strong>Designation:</strong> Senior Developer</div>
							<div class="col-md-6 mb-2"><strong>Gross Salary:</strong> ₹70,000</div>
							<div class="col-md-6 mb-2"><strong>Category:</strong> Permanent</div>
							<div class="col-md-6 mb-2"><strong>Basic Salary:</strong> ₹40,000</div>
							<div class="col-md-6 mb-2"><strong>Department:</strong> IT</div>
							<div class="col-md-6 mb-2"><strong>Employee Type:</strong> Full Time</div>
							<div class="col-md-6 mb-2"><strong>Date of Birth:</strong> 1992-01-12</div>
							<div class="col-md-6 mb-2"><strong>User Privilege:</strong> Admin</div>
							<div class="col-md-6 mb-2"><strong>Login Alias:</strong> ramesh.chauhan</div>
						</div>

					<div class="row" >
						<div class="col-md-4"></div>
							<div class="col-md-4 text-center">
								<button type="button" class="btn btn-primary px-5" id="btnUpdateEmployee" style="background-color:#2395c6; color:white;">Update</button>
							</div>
							<div class="col-md-4"></div>
					     </div>
						</div>

				<div class="card-body" id="editSectionEmoplyee" style=" display:none">
					<form >
						<div class="row px-5">
							<!-- Initial -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Initial" id="inpInitial" value="" />
									<label class="floating-label" for="inpInitial">Initial</label>
								</div>
							</div>
							<!-- First Name -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="First Name" id="inpFirstName" value="" />
									<label class="floating-label" for="inpFirstName">First Name</label>
								</div>
							</div>
							<!-- Middle Name -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Middle Name" id="inpMiddleName" value="" />
									<label class="floating-label" for="inpMiddleName">Middle Name</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- Last Name -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Last Name" id="inpLastName" value="" />
									<label class="floating-label" for="inpLastName">Last Name</label>
								</div>
							</div>
							<!-- Employee Code -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Employee Code" id="inpEmployeeCode" value="" />
									<label class="floating-label" for="inpEmployeeCode">Employee Code</label>
								</div>
							</div>
							<!-- Date of Joining -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="date" class="form-control floating-input" id="inpDOJ" value="" />
									<label class="floating-label" for="inpDOJ">Date of Joining</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- Branch -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Branch" id="inpBranch" value="" />
									<label class="floating-label" for="inpBranch">Branch</label>
								</div>
							</div>
							<!-- Grade -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Grade" id="inpGrade" value="" />
									<label class="floating-label" for="inpGrade">Grade</label>
								</div>
							</div>
							<!-- Shift -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Shift" id="inpShift" value="" />
									<label class="floating-label" for="inpShift">Shift</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- CTC -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="CTC" id="inpCTC" value="" />
									<label class="floating-label" for="inpCTC">CTC</label>
								</div>
							</div>
							<!-- Designation -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Designation" id="inpDesignation" value="" />
									<label class="floating-label" for="inpDesignation">Designation</label>
								</div>
							</div>
							<!-- Gross Salary -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Gross Salary" id="inpGrossSalary" value="" />
									<label class="floating-label" for="inpGrossSalary">Gross Salary</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- Category -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Category" id="inpCategory" value="" />
									<label class="floating-label" for="inpCategory">Category</label>
								</div>
							</div>
							<!-- Basic Salary -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Basic Salary" id="inpBasicSalary" value="" />
									<label class="floating-label" for="inpBasicSalary">Basic Salary</label>
								</div>
							</div>
							<!-- Department -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Department" id="inpDepartment" value="" />
									<label class="floating-label" for="inpDepartment">Department</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- Employee Type -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Employee Type" id="inpEmpType" value="" />
									<label class="floating-label" for="inpEmpType">Employee Type</label>
								</div>
							</div>
							<!-- DOB -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="date" class="form-control floating-input" id="inpDOB" value="" />
									<label class="floating-label" for="inpDOB">Date of Birth</label>
								</div>
							</div>
							<!-- User Privilege -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="User Privilege" id="inpPrivilege" value="" />
									<label class="floating-label" for="inpPrivilege">User Privilege</label>
								</div>
							</div>
						</div>

						<div class="row px-5">
							<!-- Login Alias -->
							<div class="col-md-4 mb-2">
								<div class="form-group mt-3 position-relative">
									<input type="text" class="form-control floating-input" placeholder="Login Alias" id="inpLoginAlias" value="" />
									<label class="floating-label" for="inpLoginAlias">Login Alias</label>
								</div>
							</div>
						</div>

					<div class="row mt-3" >
						<div class="col-md-2"></div>
						<div class="col-md-8 text-center">
							<button type="button" class="btn btn-dark px-5" id="btnBackEmployee">Back</button>
							<button type="reset" class="btn btn-secondary px-5" id="btnEmployeeClear">Clear</button>
							<button type="button" class="btn btn-primary px-5" id="btnSaveEmployee" style="background-color:#2395c6; color:white;">Save</button>

						</div>
						<div class="col-md-2"></div>
					</div>
					</form>
			     </div>
				

			</div>

			<!-- Right Side: Upload Image/Signature -->
			<div class="col-md-4">

				<!-- PHOTO Upload -->
				<div class="text-center mt-4">
					<h5>Profile Picture</h5>
					
					<img id="profileImage" src="@baseDomainUrl/uploads/defaultuserprofile/user-profile-png-image.png" alt="Profile Image" style="width: 150px; height: 150px; cursor: pointer;">
					<input type="file" id="profileInput" accept="image/jpeg" style="display: none;">
					<div id="fileInfo" class="mt-2"  style="display: none;">
						<p><span id="fileNameText" class="text-success"></span> 
							<span id="deleteBtn"><i class="fas fa-trash text-danger ms-2 cursor-pointer" aria-hidden="true"></i></span>
						</p>
						
					</div>
				</div>

				<!-- SIGNATURE Upload -->
				<!-- SIGNATURE Upload -->
				<div class="mb-4 text-center">
					<label>Upload Signature</label><br>
					<img id="empSignPreview" src="@baseDomainUrl/uploads/defaultuserprofile/default-signature.jpg"
						 style="width: 150px; height: 80px; cursor: pointer;" class="img-thumbnail" />
					<input type="file" id="empSignatureInput" class="d-none" accept=".jpg,.jpeg" />
					<small id="signFilename" class="text-success"></small>
					<div id="signFileInfo" class="mt-2" style="display:none;">
						<p>
							<span id="signFileNameText" class="text-success"></span>
							<span id="deleteSignBtn"><i class="fas fa-trash text-danger ms-2 cursor-pointer" aria-hidden="true"></i></span>
						</p>
					</div>
				</div>

				<!--Upload button-->
				<div class="text-center mt-4">
					<div id="uploadBtnTag" class="mt-2" style="display: none;">
						<button type="button" class="btn btn-primary" id="btnUpload" style="background-color:#2395c6; color:white;">Upload</button>

					</div>
				</div>

			</div>

		</div>

		
	</div>
</div>


<!-- Modal HTML -->
<div class="modal" id="cropModal" tabindex="-1" aria-labelledby="cropModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="cropModalLabel">Crop Profile Image</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<img id="cropImagePreview" src="" alt="Image preview" class="img-fluid">
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" id="cropConfirmBtn">Confirm Crop</button>
			</div>
		</div>
	</div>
</div>

<!--Addition menu-->
	<div class="card shadow mt-3 ">
		<div class="card-body p-0">
			<nav class="navbar navbar-expand-lg navbar-light bg-light rounded-top">
				<div class="container-fluid">
					<div class="collapse navbar-collapse show" id="navbarTabsOnly">
						<ul class="navbar-nav d-flex flex-wrap text-center">
							<li class="nav-item">
								<a class="nav-link active" href="#">
									<i class="fas fa-id-card"></i>
									Employee Personal Info
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="#">
									<i class="fas fa-phone-alt"></i>
									Contact
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									<i class="fas fa-user-shield"></i>
									Emergency Contact(s)
								</a>
							</li>
							
							<li class="nav-item">
								<a class="nav-link" href="#">
									<i class="fas fa-briefcase"></i>
									Reporting & Contract
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									<i class="fas fa-paperclip"></i>
									Attachments
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									<i class="fas fa-money-bill-wave"></i>
									Allowance
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									<i class="fas fa-coins"></i>
									Salary
								</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>

		</div>
	<div id="partialViewContainer">
		<!-- Partial content will load here -->
		<div class="d-flex justify-content-center align-items-center" style="height: 10vh;">
			<div class="spinner-border text-primary" role="status">
				<span class="visually-hidden">Loading...</span>
			</div>
		</div>

	</div>
	</div>



<!-- CropperJS CSS & JS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
	let cropper;
	let selectedFile;
	let currentCropTarget = '';
	let profileFile=null;
	let signatureFile=null;

	 $("#backArrow").click(() => {
		const baseUrl = '@Url.Content("~/")';
		window.location.href = baseUrl + "EmployeeMaster/EmployeeMaster";
	});
	 $("#btnBackEmployee").click(() => {
			$("#displaySectionEmoplyee").show();
			$("#editSectionEmoplyee").hide();
		});
		 $("#btnUpdateEmployee").click(() => {
			$("#displaySectionEmoplyee").hide();
			$("#editSectionEmoplyee").show();
		});

	// Trigger file input
	$('#profileImage').click(() => $('#profileInput').click());

	// File selected
	$('#profileInput').change(function () {
		const file = this.files[0];
		// if (!file || !file.name.toLowerCase().endsWith(".jpg")) {
		// 	alert("Only JPG files are allowed.");
		// 	resetAll();
		// 	return;
		// }

		selectedFile = file;
		const reader = new FileReader();
		reader.onload = function (e) {
			$('#cropImagePreview').attr('src', e.target.result);
			$('#cropImagePreview').on('load', function () {
				// Initialize Cropper only after the image is fully loaded
				initCropper();
			});

			// Show the modal directly when the file is loaded
			const modal = new bootstrap.Modal(document.getElementById('cropModal'));
			modal.show();
		};
		reader.readAsDataURL(file);
	});

	// Function to initialize the cropper
	function initCropper() {
		const image = document.getElementById('cropImagePreview');

		// Destroy any previous cropper instance before creating a new one
		if (cropper) {
			cropper.destroy();
		}

		// Initialize cropper
		cropper = new Cropper(image, {
			aspectRatio: 1,
			viewMode: 1,
			autoCropArea: 1,
			ready() {
				// Optionally, you can set focus or trigger other UI updates after cropper is ready
			}
		});
	}

	// On Modal hidden - destroy cropper
	$('#cropModal').on('hidden.bs.modal', function () {
		if (cropper) {
			cropper.destroy();
			cropper = null;
		}
	});

	// // Confirm crop
	// $('#cropConfirmBtn').click(function () {
	// 	if (!cropper) {
	// 		alert("Cropper not initialized.");
	// 		return;
	// 	}

	// 	const canvas = cropper.getCroppedCanvas({ width: 150, height: 150 });
	// 	const dataURL = canvas.toDataURL("image/jpeg");

	// 	$('#profileImage').attr('src', dataURL); // Update the profile image
	// 	$('#fileNameText').text(selectedFile.name);
	// 	$('#fileInfo').show(); // Show the file info

	// 	// Hide modal
	// 	bootstrap.Modal.getInstance(document.getElementById('cropModal')).hide();
	// });

	// // Delete all
	$('#deleteBtn').click(() => resetProfile());

	function resetProfile() {
		$('#profileInput').val('');
		$('#profileImage').attr('src', '@baseDomainUrl/uploads/defaultuserprofile/user-profile-png-image.png');
		$('#fileInfo').hide();
		selectedFile = null;
		profileFile=null;
		if (cropper) {
			cropper.destroy();
			cropper = null;
		}
	}


	$('#cropConfirmBtn').click(function () {
		if (!cropper) {
			alert("Cropper not initialized.");
			return;
		}

		const canvas = currentCropTarget === 'signature'
			? cropper.getCroppedCanvas({ width: 150, height: 80 })
			: cropper.getCroppedCanvas({ width: 150, height: 150 });

		const dataURL = canvas.toDataURL("image/jpeg");

		if (currentCropTarget === 'signature') {
			$('#empSignPreview').attr('src', dataURL);
			$('#signFileNameText').text(selectedFile.name);
			signatureFile=selectedFile;
			$('#signFileInfo').show();
		} else {
			$('#profileImage').attr('src', dataURL);
			$('#fileNameText').text(selectedFile.name);
			profileFile=selectedFile;
			$('#fileInfo').show();
		}
		showUploadButton();
		bootstrap.Modal.getInstance(document.getElementById('cropModal')).hide();
	});



	//signature

	$('#empSignPreview').click(() => $('#empSignatureInput').click());

	// Signature file selected
	$('#empSignatureInput').change(function () {
		const file = this.files[0];

		if (!file || !file.name.toLowerCase().endsWith(".jpg")) {
			alert("Only JPG files are allowed for signature.");
			resetSignature();
			return;
		}

		selectedFile = file;
		currentCropTarget = 'signature';

		const reader = new FileReader();
		reader.onload = function (e) {
			$('#cropImagePreview').attr('src', e.target.result);
			$('#cropImagePreview').on('load', function () {
				initCropperSignature(); // for signature aspect
			});

			const modal = new bootstrap.Modal(document.getElementById('cropModal'));
			modal.show();
		};
		reader.readAsDataURL(file);
	});

	// Delete Signature
	$('#deleteSignBtn').click(() => resetSignature());

	function initCropperSignature() {
		const image = document.getElementById('cropImagePreview');
		if (cropper) cropper.destroy();

		cropper = new Cropper(image, {
			aspectRatio: 150 / 80,
			viewMode: 1,
			autoCropArea: 1
		});
	}

	function resetSignature() {
		$('#empSignatureInput').val('');
		$('#empSignPreview').attr('src', '@baseDomainUrl/uploads/defaultuserprofile/default-signature.jpg');
		$('#signFileInfo').hide();
		selectedFile = null;
		signatureFile=null;
		if (cropper) {
			cropper.destroy();
			cropper = null;
		}
	}

	function showUploadButton(){
		if(!profileFile &&!signatureFile)
		{
			$("#uploadBtnTag").show();
		}
	}
</script>


	<script>

		let partialUrlMap = {
							"Employee Personal Info": "@Url.Action("EmployeeInfo", "PartialView")",
							"Contact": "@Url.Action("Contact", "PartialView")",
							"Emergency Contact(s)": "@Url.Action("EmergencyContact", "PartialView")",
							"Reporting & Contract": "@Url.Action("Reporting", "PartialView")",
							"Attachments": "@Url.Action("Attachments", "PartialView")",
							"Allowance": "@Url.Action("Allowance", "PartialView")",
							"Salary": "@Url.Action("Salary", "PartialView")"
					};

	$(document).ready(function () {
		let defaultMenu = "Employee Personal Info";
		let defaultUrl = partialUrlMap[defaultMenu];
		$('#partialViewContainer').load(defaultUrl);
		$('.nav-link').on('click', function (e) {
			e.preventDefault();

			// Switch active class
			$('.nav-link').removeClass('active');
			$(this).addClass('active');

			// Load partial view (simulate or use actual URL)
			let menu = $(this).text().trim();

			// Simulate URLs (replace with actual URLs or controller actions)
				

			let url = partialUrlMap[menu] || "/PartialView/EmployeeInfo";

			// Load partial view via AJAX
			$('#partialViewContainer').load(url);
		});
	});
</script>




@{
	ViewData["Title"] = "Privilege Master";
	Layout = "~/Views/Shared/_mainLayout.cshtml";
	string baseUrl = Configuration["BaseUrlSettings:baseUrl"];
}

<style>
	.scrollable-container {
		height: 150px; /* Set a fixed height */
		width: 200px; /* Set a fixed width */
		overflow-y: auto; /* Enable vertical scrolling */
		border: 1px solid #ccc; /* Optional: Add a border for visual clarity */
		padding: 5px; /* Optional: Add padding for spacing */
	}

	.select-all {
		margin-bottom: 5px;
		padding: 3px;
		border-bottom: 1px solid #eee; /* Optional: Add a subtle border for separation */
	}

	.branch-item, .department-item, .vertical-item {
		margin: 3px 0;
		padding: 3px;
		border: 1px solid #eee; 
		border-radius: 5px; /* Optional: Round the corners */
		word-wrap: break-word;
	}

	.branch-checkbox, .department-checkbox, .vertical-checkbox, .select-all-checkbox {
		margin-right: 10px;
	}

	.table-container {
		max-width: 100%; /* Fixed width */
		max-height: 300px; /* Fixed height */
		overflow: auto; /* Enable scrolling */
		border: 1px solid #ccc;
		margin: 20px;
	}

	table {
		width: 100%;
		border-collapse: collapse;
	}

	th, td {
		border: 1px solid black;
		padding: 8px;
		text-align: center;
	}

	th {
		background-color: #f2f2f2;
		position: sticky;
		top: 0; /* Stick the header to the top */
	}

	tr:nth-child(even) {
		background-color: #f9f9f9; /* Alternate row color */
	}

	.indent {
		padding-left: 20px;
	}

	.indent-more {
		padding-left: 40px;
	}
	.subpage-cell {
  padding-left: 30px;
}

.subsubpage-cell {
  padding-left: 60px;
}



</style>
<style>
	
	th, td {
		border: 1px solid #ced4da;
		padding: 8px;
		text-align: left;
		cursor: pointer;
		margin-right: 5px;
	}
	.toggle-icon {
		cursor: pointer;
		margin-right: 8px;
		font-size: 12px;
		color: #2395c6;
	}

	.submenu {
		display: none;
	}

	

	.module-header {
		background-color: #2395c6;
		color: white;
		font-weight: bold;
       text-align:left;
	}

	.form-check-input {
		cursor: pointer;
	}
</style>
<div class="card">
	<div class="card-header bg-transparent ml-0 py-0">
		<div class="row m-2">
			<div class="col-6 ">
				<h6 class="pt-2 mb-0">
				 Privilege Master
				</h6>
			</div>

			<div class="col-6 d-flex justify-content-end align-items-center">
				<div class="font-22 pl-2" style="color:#32393f; cursor:pointer;">
					@* 					<i class="fadeIn animated bx bx-refresh" id="refreshData" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Refresh Data"></i>
 *@				
                    <button id="addPrivilegeMaster"
							type="button"
							class="btn mr-1 rounded-1 "
							style="background-color:#2395c6; color:white;">
						Add
					</button>
				</div>
			</div>
		</div>
	</div>
	<div class="card-body " >

		<div class="row">
			<div class="col-md-12">
				<div class="form-group">
					<div class="rowCount" id="rowCountPrivilegeMaster"></div>
					<div id="gridContainerPrivilegeMaster">
						<div class="d-flex justify-content-center align-items-center" style="height: 10vh;">
							<div class="spinner-border text-primary" role="status">
								<span class="visually-hidden">Loading...</span>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>

</div>


<div class="modal fade" id="addPrivilegeMasterModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h6 class="modal-title btn-heading-title" id="exampleModalLabel">
					<span class="formType">Add</span> Privileges
				</h6>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body modal-body-font" style="font-size:12px;">


				<div class="row">

					<div class="col-md-6">
						<div class="form-group mt-3 position-relative">
							<input type="text" class="form-control floating-input" id="txtPrivilegeName" placeholder=" ">
							<label class="floating-label" for="txtPrivilegeName">Privilege Name*</label>
							<span id="spnPrivilegeName" style="color:red; display:none;">Please Enter Privilege Name</span>

						</div>
					</div>

					<div class="col-md-6">
						<div class="form-group mt-3 position-relative">
							<select class="form-select floating-input" id="ddlPagePanel">
								<option value="">Select</option>
								<!-- Add your options here -->
							</select>
							<label class="floating-label" for="ddlPagePanel">Page Panel </label>
						</div>
					</div>

				</div>

				<!-- New Fields -->
				<div class="row">
					<div class="col-md-3 mt-3">
						<div id="branchesContainer" class="scrollable-container">
							<div class="select-all">
								<input type="checkbox" id="selectAllBranch" class="select-all-checkbox">
								<label for="selectAllBranch"><strong>Branch</strong></label>
							</div>
						</div>

					</div>
					<div class="col-md-3 mt-3">
						<div id="departmentContainer" class="scrollable-container">
							<div class="select-all">
								<input type="checkbox" id="selectAllDepartment" class="select-all-checkbox">
								<label for="selectAllDepartment"><strong>Department</strong></label>
							</div>

						</div>

					</div>
					<div class="col-md-3 mt-3">
						<div id="verticalContainer" class="scrollable-container">
							<div class="select-all">
								<input type="checkbox" id="selectAllVertical" class="select-all-checkbox">
								<label for="selectAllVertical"><strong>Vertical</strong></label>
							</div>
						</div>

					</div>


				</div>

			

				<div class="row">
					<div class="col-md-12 mt-3">
						<div class="container mt-4">
							<table id="dynamicTable" class="table table-bordered p-0">
								<thead class="table-light">
									<tr>
										<th style="width: 40%">Name</th>
										<th>View</th>
										<th>Edit</th>
										<th>Save</th>
										<th>Delete</th>
									</tr>
								</thead>
								<tbody></tbody> <!-- Data will be populated dynamically -->
							</table>
						</div>

							@* <div class="container mt-4">
								<table class="table table-bordered p-0">
									<thead class="table-light">
										<tr>
											<th style="width: 40%">Name</th>
											<th>View</th>
											<th>Edit</th>
											<th>Save</th>
											<th>Delete</th>
										</tr>
									</thead>
									<tbody>
										<tr class="module-header">
											<td colspan="5">ESS Module</td>
										</tr>

										<!-- Parent: Employee -->
										<tr>
											<td colspan="5">
												<span class="toggle-icon" data-target="emp-sub">▶</span>
												<input type="checkbox" class="form-check-input parent" data-id="emp" /> Employee
											</td>
										</tr>

										<!-- Submenu: My Profile -->
										<tr class="submenu emp-sub">
											<td class="indent" colspan="5">
												<span class="toggle-icon" data-target="profile-sub">▶</span>
												<input type="checkbox" class="form-check-input child" data-parent="emp" /> My Profile
											</td>
											
										</tr>
										<!-- Sub-submenu under My Profile -->
										<tr class="submenu profile-sub">
											<td class="sub-indent">
												<input type="checkbox" class="form-check-input child child-profile" data-parent="emp" /> Contact Info
											</td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
										</tr>

										<tr class="submenu profile-sub">
											<td class="sub-indent">
												<input type="checkbox" class="form-check-input child child-profile" data-parent="emp" /> Qualification
											</td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
										</tr>

										<!-- Submenu: Salary Tab -->
										<tr class="submenu emp-sub">
											<td class="indent">
												<input type="checkbox" class="form-check-input child" data-parent="emp" /> View Salary Tab (For Manager)
											</td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
										</tr>

										<!-- Submenu: Allowance Tab -->
										<tr class="submenu emp-sub">
											<td class="indent">
												<input type="checkbox" class="form-check-input child" data-parent="emp" /> View Allowance Tab
											</td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
											<td><input type="checkbox" class="form-check-input child-action" data-parent="emp" /></td>
										</tr>
									</tbody>
								</table>
							</div>
 *@
						
					</div>
					

				</div>


			</div>

			<div class="modal-footer btn-heading-title">
				<button type="button" class="btn btn-primary" id="btnAddPrivilegeMaster" style="background-color:#2395c6; color:white;">Save</button>
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
		$(document).on('click', '.toggle-icon', function() {
		var target = $(this).data('target');
		var rows = $('.' + target);
		if (rows.is(':visible')) {
			rows.hide();
			$(this).text('▶');
		} else {
			rows.show();
			$(this).text('▼');
		}
	});

	$(document).on('change', '.parent', function() {
		var id = $(this).data('id');
		var isChecked = $(this).is(':checked');

		// Set the state of all child checkboxes based on the parent checkbox
		$('.child[data-parent="' + id + '"]').prop('checked', isChecked);

		// Set the state of all child-action checkboxes based on the parent checkbox
		$('.child-action[data-parent="' + id + '"]').prop('checked', isChecked);

		// Recursively set the state of all sub-subpages checkboxes
		$('.child[data-parent="' + id + '"]').each(function() {
			var childId = $(this).data('parent');
			$('.child[data-parent="' + childId + '"]').prop('checked', isChecked);
			$('.child-action[data-parent="' + childId + '"]').prop('checked', isChecked);
		});
	});

	$(document).on('change', '.child', function() {
		var parentId = $(this).data('parent');
		var parent = $('.parent[data-id="' + parentId + '"]');
		var anyChecked = $('.child[data-parent="' + parentId + '"]:checked').length > 0;
		parent.prop('checked', anyChecked);

		var isChecked = $(this).is(':checked');
		$(this).closest('tr').nextAll('.submenu').find('.child-profile').prop('checked', isChecked);

		if (!isChecked) {
			$(this).closest('tr').find('.child-action').prop('checked', false);
		}
	});

	// Function to close all child rows
	function closeAllChildRows(parentId) {
		var childRows = $('.submenu[data-parent="' + parentId + '"]');
		childRows.hide();
		childRows.find('.toggle-icon').text('▶');

		// Recursively close all sub-subpages rows
		childRows.each(function() {
			var childId = $(this).data('parent');
			closeAllChildRows(childId);
		});
	}

	// Modify the toggle-icon click handler to close all child rows
	$(document).on('click', '.toggle-icon', function() {
		var target = $(this).data('target');
		var rows = $('.' + target);
		if (rows.is(':visible')) {
			closeAllChildRows(target);
		} else {
			rows.show();
			$(this).text('▼');
		}
	});

	async function GetPageData(){
				var companyId = $('#companyDropdown').val();
			if (!companyId) {
				round_error_noti("Please select company");
				return;
			}
			debugger
				 console.log($('#ddlPagePanel option'));

		// Example: Check the length of the selected options
		console.log($('#ddlPagePanel option').length);

				var pagePanelId = $('#ddlPagePanel').val();
				if (!pagePanelId) {
					round_error_noti("Please select page panel");
					return;
				}

			var payloadData = {
				pagePanelId: pagePanelId,
				companyId: companyId
			};

			$.ajax({
				url: '@baseUrl/PageMasterAPI/GetPageHierarchyWithPrivileges', // Replace with actual API URL
				method: 'POST',
				contentType: 'application/json',
				data: JSON.stringify(payloadData),
				success: function(response) {
					debugger;
					if (response.isSuccess) {
						console.log(response.data); // Corrected this line
						bindTableData(response.data);
					} else {
						round_error_noti(response.responseMessage);
					}
				},
				error: function(xhr, status, error) {
					console.error("API Error: ", error);
				}
			});

	}

function bindTableData(data) {
	  var tbody = $('#dynamicTable tbody');
	  tbody.empty();

	  data.forEach(panel => {
		// Add panel header row
		var panelRow = `<tr class="module-header"><td colspan="5">${panel.pagePanelName} Module</td></tr>`;
		tbody.append(panelRow);

		// Iterate over pages
		panel.pages.forEach(page => {
		  // Add page row
		  var parentRow = `<tr>
			<td colspan="5">
			  <span class="toggle-icon" data-target="${page.pageMasterId}-sub">▶</span>
			  <input type="checkbox" class="form-check-input parent" data-id="${page.pageMasterId}" /> ${page.pageName}
			</td>
		  </tr>`;
		  tbody.append(parentRow);

		  // Iterate over subPages
		  if (page.subPages) {
			page.subPages.forEach(subPage => {
			  // Check if subPage has subSubPages
			  if (subPage.subSubPages) {
				// Add subPage row without action checkboxes
				var subRow = `<tr class="submenu ${page.pageMasterId}-sub">
				  <td class="indent">
					<span class="toggle-icon" data-target="${subPage.pageMasterId}-sub">▶</span>
					<input type="checkbox" class="form-check-input child" data-parent="${page.pageMasterId}" /> ${subPage.pageName}
				  </td>
				  <td colspan="4"></td>
				</tr>`;
				tbody.append(subRow);

				// Iterate over subSubPages
				subPage.subSubPages.forEach(subSubPage => {
				  // Add subSubPage row with action checkboxes
				  var subSubRow = `<tr class="submenu ${subPage.pageMasterId}-sub">
					<td class="indent-more">
					  <input type="checkbox" class="form-check-input child" data-parent="${subPage.pageMasterId}" /> ${subSubPage.pageName}
					</td>
					<td><input type="checkbox" class="form-check-input child-action" ${subSubPage.is_View ? 'checked' : ''}></td>
					<td><input type="checkbox" class="form-check-input child-action" ${subSubPage.is_Edit ? 'checked' : ''}></td>
					<td><input type="checkbox" class="form-check-input child-action" ${subSubPage.is_Save ? 'checked' : ''}></td>
					<td><input type="checkbox" class="form-check-input child-action" ${subSubPage.is_Delete ? 'checked' : ''}></td>
				  </tr>`;
				  tbody.append(subSubRow);
				});
			  } else {
				// Add subPage row with action checkboxes and no toggle icon
				var subRow = `<tr class="submenu ${page.pageMasterId}-sub">
				  <td class="indent">
					<input type="checkbox" class="form-check-input child" data-parent="${page.pageMasterId}" /> ${subPage.pageName}
				  </td>
				  <td><input type="checkbox" class="form-check-input child-action" ${subPage.is_View ? 'checked' : ''}></td>
				  <td><input type="checkbox" class="form-check-input child-action" ${subPage.is_Edit ? 'checked' : ''}></td>
				  <td><input type="checkbox" class="form-check-input child-action" ${subPage.is_Save ? 'checked' : ''}></td>
				  <td><input type="checkbox" class="form-check-input child-action" ${subPage.is_Delete ? 'checked' : ''}></td>
				</tr>`;
				tbody.append(subRow);
			  }
			});
		  }
		});
	  });
	}


	    async function initializePage() {

			// Ensure company details are loaded first
			await LoadCompanyDetails();

			// Bind the page panel after loading company (details)

			// Fetch page data
			await GetPageData();
		}

	async function bindPagePanel(){

	   $.ajax({
			url: '@baseUrl/PagePanelAPI/GetAllPagePanels',
			method: 'GET',
			success: function(data) {
				if(data.isSuccess){
					var dropdowns = $('#ddlPagePanel');
					dropdowns.empty();
					$.each(data.data, function(index, panel) {
						debugger;
							dropdowns.append($('<option >', {
							value: panel.pagePanelId,
							text: panel.pagePanelName
						}));
					});


				}
			},
			error: function(error) {
				console.error('Error fetching page penel data:', error);
			}
		});

	}


	$("#addPrivilegeMaster").click( async () => {
			await	 initializePage();

		   $("#addPrivilegeMasterModal").modal('show');

	})
		
	function bindBranch() {
		$.ajax({
			url: '@baseUrl/BranchAPI/GetAllBranch',
			method: 'GET',
			success: function(data) {
				if (data.isSuccess) {
					const branchesContainer = $('#branchesContainer');
					branchesContainer.find('.branch-item').remove(); // Clear existing branch items

					// Iterate over each branch in the data
					data.data.forEach(branch => {
						// Create a div for each branch
						const branchDiv = $('<div>', {
							class: 'branch-item',
							'data-branch-id': branch.branchId
						});

						// Create a checkbox for each branch
						const checkbox = $('<input>', {
							type: 'checkbox',
							id: `branch-${branch.branchId}`,
							class: 'branch-checkbox'
						});

						// Create a label for the checkbox
						const label = $('<label>', {
							for: `branch-${branch.branchId}`,
							text: branch.branchName
						});

						// Append the checkbox and label to the branch div
						branchDiv.append(checkbox, label);

						// Append the branch div to the container
						branchesContainer.append(branchDiv);
					});

					// Add event listener for the "Select All" checkbox
					$('#selectAllBranch').on('change', function() {
						const isChecked = $(this).is(':checked');
						$('.branch-checkbox').prop('checked', isChecked);
					});
				}
			},
			error: function(error) {
				console.error('Error fetching branch data:', error);
			}
		});
	}


	
	function bindDepartment() {
		$.ajax({
			url: '@baseUrl/DepartmentAPI/GetAllDepartment',
			method: 'GET',
			success: function(data) {
				console.log('Data received:', data); // Log the data to the console

				if (data.isSuccess && data.data) {
					const departmentsContainer = $('#departmentContainer'); // Ensure this ID matches your HTML

					// Check if the container exists
					if (!departmentsContainer.length) {
						console.error('Departments container not found');
						return;
					}

					departmentsContainer.find('.department-item').remove(); // Clear existing department items

					// Iterate over each department in the data
					data.data.forEach(department => {
						// Create a div for each department
						const departmentDiv = $('<div>', {
							class: 'department-item',
							'data-department-id': department.departmentId
						});

						// Create a checkbox for each department
						const checkbox = $('<input>', {
							type: 'checkbox',
							id: `department-${department.departmentId}`,
							class: 'department-checkbox'
						});

						// Create a label for the checkbox
						const label = $('<label>', {
							for: `department-${department.departmentId}`,
							text: department.departmentName
						});

						// Append the checkbox and label to the department div
						departmentDiv.append(checkbox, label);

						// Append the department div to the container
						departmentsContainer.append(departmentDiv);
					});

					// Add event listener for the "Select All" checkbox
					$('#selectAllDepartment').on('change', function() {
						const isChecked = $(this).is(':checked');
						$('.department-checkbox').prop('checked', isChecked);
					});
				} else {
					console.error('Data fetch was not successful or data is missing');
				}
			},
			error: function(error) {
				console.error('Error fetching department data:', error);
			}
		});
	}

	// Call the function to bind departments
	$(document).ready( async function() {
		await bindPagePanel();
     	bindBranch();
		bindDepartment();
		$('#companyDropdown').change(function() {
				GetPageData();
		});

		// Bind change event for page panel dropdown
		$('#ddlPagePanel').change(function() {
				GetPageData();
		});
	});


	
	 //  const privilegeData = [
		// 	{ privilegeName: "Control Panel", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Company Information", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: false },
		// 	{ privilegeName: "Change Password", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: false },
		// 	{ privilegeName: "Company General Setting", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Professional Tax Setting", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Privilege Setting", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Import Data", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Scheme", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Email Setting", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Admin Settings", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Employee Directory", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Masters", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Employee", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Leave", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true },
		// 	{ privilegeName: "Loan/Claim", viewPrivilege: true, editPrivilege: true, savePrivilege: true, deletePrivilege: true }
		// ];

		// const tableBody = document.querySelector('#privilegeTable tbody');

		// privilegeData.forEach(privilege => {
		// 	const row = document.createElement('tr');

		// 	const nameCell = document.createElement('td');
		// 	nameCell.textContent = privilege.privilegeName;
		// 	row.appendChild(nameCell);

		// 	const viewCell = document.createElement('td');
		// 	const viewCheckbox = document.createElement('input');
		// 	viewCheckbox.type = 'checkbox';
		// 	viewCheckbox.checked = privilege.viewPrivilege;
		// 	viewCell.appendChild(viewCheckbox);
		// 	row.appendChild(viewCell);

		// 	const editCell = document.createElement('td');
		// 	const editCheckbox = document.createElement('input');
		// 	editCheckbox.type = 'checkbox';
		// 	editCheckbox.checked = privilege.editPrivilege;
		// 	editCell.appendChild(editCheckbox);
		// 	row.appendChild(editCell);

		// 	const saveCell = document.createElement('td');
		// 	const saveCheckbox = document.createElement('input');
		// 	saveCheckbox.type = 'checkbox';
		// 	saveCheckbox.checked = privilege.savePrivilege;
		// 	saveCell.appendChild(saveCheckbox);
		// 	row.appendChild(saveCell);

		// 	const deleteCell = document.createElement('td');
		// 	const deleteCheckbox = document.createElement('input');
		// 	deleteCheckbox.type = 'checkbox';
		// 	deleteCheckbox.checked = privilege.deletePrivilege;
		// 	deleteCell.appendChild(deleteCheckbox);
		// 	row.appendChild(deleteCell);

		// 	tableBody.appendChild(row);
		// });
</script>
<script>
	   $("#btnAddPrivilegeMaster").click(  () => {
			  savePrivilageData();

	  })
	  function savePrivilageData() {

			var branches = getSelectedBranches();
			  var departments = getSelectedDepartments();
			  var subpageActions = getSubpageActions();
			   var pageName = $('#txtPrivilegeName').val();
			   var pagePanel = $('#ddlPagePanel').val();

			  var payload = {
				  pageName: pageName,
				  pagePanel: pagePanel,
				  branches: branches,
				  departments: departments,
				  subpageActions: subpageActions
			  };
				console.log("payload",payload);
		  // $.ajax({
			 //  url: '@baseUrl/YourAPIEndpoint/SaveData', // Replace with your actual API URL
			 //  method: 'POST',
			 //  contentType: 'application/json',
			 //  data: JSON.stringify(payload),
			 //  success: function(response) {
				//   if (response.isSuccess) {
				// 	  alert('Data saved successfully!');
				//   } else {
				// 	  alert('Error saving data: ' + response.responseMessage);
				//   }
			 //  },
			 //  error: function(xhr, status, error) {
				//   console.error("API Error: ", error);
				//   alert('Error saving data.');
			 //  }
		  // });
	  }

	 function getSubpageActions() {
		  var subpageActions = [];
		  $('.child-action').each(function() {
			  var subpageId = $(this).data('parent');
			  var actionType = $(this).closest('td').index() === 1 ? 'View' :
							   $(this).closest('td').index() === 2 ? 'Edit' :
							   $(this).closest('td').index() === 3 ? 'Save' : 'Delete';
			  var isChecked = $(this).is(':checked');

			  var existingEntry = subpageActions.find(function(entry) {
				  return entry.id === subpageId;
			  });

			  if (!existingEntry) {
				  existingEntry = { id: subpageId };
				  subpageActions.push(existingEntry);
			  }

			  existingEntry[actionType.toLowerCase()] = isChecked;
		  });
		  return subpageActions;
	  }

	  function getSelectedBranches() {
		  var selectedBranches = [];
		  $('.branch-checkbox:checked').each(function() {
			  selectedBranches.push($(this).closest('.branch-item').data('branch-id'));
		  });
		  return selectedBranches.join('#');
	  }

	  function getSelectedDepartments() {
		  var selectedDepartments = [];
		  $('.department-checkbox:checked').each(function() {
			  selectedDepartments.push($(this).closest('.department-item').data('department-id'));
		  });
		  return selectedDepartments.join('#');
	  }



</script>